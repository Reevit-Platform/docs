---
title: Connections
description: Connect your own PSP accounts to Primeflow (Bring Your Own Key)
icon: Link
---

import { CreditCard, ShieldCheck, Shuffle, Webhook } from "lucide-react"

# Connections

Connect your existing payment service provider (PSP) accounts to Primeflow. This "Bring Your Own Key" (BYOK) model means you maintain direct relationships with providers while benefiting from Primeflow's unified API, smart routing, and failover capabilities.

![Connections Diagram](/images/connections/byok-diagram.svg)

## Why BYOK?

### The Traditional Model (What We're Not)

Many payment aggregators require you to:
- Use their merchant accounts
- Pay higher fees (they take a cut)
- Lose direct relationship with providers
- Limited control over your payment processing

### The Primeflow Model (BYOK)

With Primeflow, you:
- **Use your own PSP accounts** - Direct relationships, better rates
- **Keep existing contracts** - No need to switch providers
- **Maintain control** - You own the accounts, we orchestrate
- **Save money** - No middleman markup, just orchestration fees

**Result**: Better rates, more control, same unified API experience.

---

## How Connections Work

A **connection** represents your credentials for a specific PSP account. Think of it as linking your existing Paystack, Hubtel, or Stripe account to Primeflow.

### What Primeflow Does

1. **Stores credentials securely** - Encrypted at rest, never exposed
2. **Routes payments intelligently** - Uses your connections based on success rates, fees, and availability
3. **Handles failover** - If one connection fails, automatically tries another
4. **Unifies responses** - Same API response format regardless of provider

### What You Keep

- **Direct provider relationships** - You still own the accounts
- **Provider dashboards** - Access Paystack/Hubtel/etc. dashboards directly
- **Provider support** - Contact providers directly for account issues
- **Negotiated rates** - Your existing fee structures remain

---

## Supported Providers

Primeflow supports major payment providers across Africa and globally:

| Provider | Countries | Methods | Best For |
|----------|-----------|---------|----------|
| **Paystack** | GH, NG | Card, Mobile Money, Bank | Nigeria & Ghana coverage, high success rates |
| **Hubtel** | GH | Mobile Money, USSD | Ghana mobile money dominance |
| **Flutterwave** | GH, NG, KE | Card, Mobile Money, Bank | Pan-African coverage |
| **Monnify** | NG | Card, Bank Transfer | Nigeria bank transfers |
| **M-Pesa** | KE | Mobile Money | Kenya market leader |
| **Stripe** | Global (50+ countries) | Card, Apple Pay, Google Pay | International customers, global reach |

### Choosing Providers

**For Ghana-focused businesses**:
- **Primary**: Hubtel (best mobile money coverage)
- **Backup**: Paystack (good card support)
- **International**: Stripe (for global customers)

**For Nigeria-focused businesses**:
- **Primary**: Paystack (market leader)
- **Backup**: Flutterwave (good coverage)
- **Bank transfers**: Monnify (specialized)

**For Pan-African businesses**:
- **Multiple providers**: Connect all relevant providers
- **Let Primeflow route**: We'll automatically use the best one

---

## Creating Your First Connection

Let's connect your Paystack account:

```bash
curl -X POST https://api.primeflow.com/v1/connections \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: conn-paystack-001" \
  -H "Content-Type: application/json" \
  -d '{
    "id": "paystack_live",
    "provider": "paystack",
    "mode": "live",
    "status": "active",
    "credentials": {
      "secret_key": "sk_live_xxx",
      "public_key": "pk_live_xxx"
    },
    "capabilities": {
      "methods": ["card", "momo"],
      "countries": ["GH", "NG"]
    },
    "labels": ["primary", "ghana"]
  }'
```

### Understanding the Request

| Field | Description | Why It Matters |
|-------|-------------|----------------|
| `id` | Unique connection identifier | Use descriptive names like `paystack_gh_live` |
| `provider` | PSP name | Tells Primeflow which provider API to use |
| `mode` | `live` or `sandbox` | Use `sandbox` for testing |
| `status` | `active` or `inactive` | Inactive connections won't be used for routing |
| `credentials` | Provider-specific keys | Securely encrypted and stored |
| `capabilities` | What this connection supports | Helps Primeflow route intelligently |
| `labels` | Tags for routing hints | Use labels like `primary`, `fallback`, `ghana` |

### Connection ID Best Practices

Use descriptive IDs that indicate:
- **Provider**: `paystack`, `hubtel`, `stripe`
- **Country**: `gh`, `ng`, `ke`
- **Environment**: `live`, `sandbox`
- **Purpose**: `primary`, `backup`

**Examples**:
- `paystack_gh_live` - Paystack Ghana live account
- `hubtel_gh_live_primary` - Hubtel Ghana primary connection
- `stripe_global_live` - Stripe for international customers

---

## Provider Credentials

Each provider requires different credentials. Here's what you need:

### Paystack

```json
{
  "secret_key": "sk_live_xxx",
  "public_key": "pk_live_xxx"
}
```

**Where to find**: Paystack Dashboard → Settings → API Keys & Webhooks

**Security**: Never expose secret keys in client-side code. They're only used server-side.

### Hubtel

```json
{
  "client_id": "xxx",
  "client_secret": "xxx",
  "merchant_account": "xxx"
}
```

**Where to find**: Hubtel Dashboard → Developer → API Credentials

**Note**: Hubtel requires merchant account number in addition to API credentials.

### Flutterwave

```json
{
  "secret_key": "FLWSECK_xxx",
  "public_key": "FLWPUBK_xxx",
  "encryption_key": "xxx"
}
```

**Where to find**: Flutterwave Dashboard → Settings → API

**Security**: Encryption key is required for certain operations.

### Monnify

```json
{
  "api_key": "xxx",
  "secret_key": "xxx",
  "contract_code": "xxx"
}
```

**Where to find**: Monnify Dashboard → Settings → API Credentials

**Note**: Contract code is unique to your Monnify account.

### M-Pesa

```json
{
  "consumer_key": "xxx",
  "consumer_secret": "xxx",
  "passkey": "xxx",
  "business_short_code": "174379"
}
```

**Where to find**: Safaricom Developer Portal → My Apps → Credentials

**Note**: M-Pesa requires business short code for production.

### Stripe

```json
{
  "secret_key": "sk_live_xxx",
  "publishable_key": "pk_live_xxx",
  "webhook_secret": "whsec_xxx"
}
```

**Where to find**: Stripe Dashboard → Developers → API keys

**Important**: 
- Configure your Primeflow webhook URL in Stripe Dashboard
- Include `org_id`, `connection_id`, and `payment_id` in PaymentIntent metadata
- Webhook secret is used to verify incoming webhook signatures

---

## Testing Connections

Always test credentials before saving to production:

```bash
curl -X POST https://api.primeflow.com/v1/connections/test \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: test-paystack-001" \
  -d '{
    "provider": "paystack",
    "credentials": {
      "secret_key": "sk_live_xxx"
    }
  }'
```

**Response:**
```json
{
  "ok": true,
  "message": "Connection validated successfully"
}
```

**Why Test?**
- **Catch errors early**: Invalid credentials won't work in production
- **Verify access**: Ensure API keys have correct permissions
- **Save time**: Avoid debugging failed payments later

---

## Managing Connections

### List All Connections

```bash
curl https://api.primeflow.com/v1/connections \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "connections": [
    {
      "id": "paystack_live",
      "provider": "paystack",
      "mode": "live",
      "status": "active",
      "capabilities": {
        "methods": ["card", "momo"],
        "countries": ["GH", "NG"]
      },
      "health_score": 0.98,
      "labels": ["primary"],
      "created_at": "2025-02-10T10:00:00Z"
    }
  ]
}
```

**Use Cases**:
- **Dashboard display**: Show all connections to users
- **Health monitoring**: Check health scores
- **Audit**: Review connection configurations

### Get Single Connection

```bash
curl https://api.primeflow.com/v1/connections/paystack_live \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Use Cases**:
- **Connection details**: View full connection information
- **Troubleshooting**: Check connection status and health
- **Configuration review**: Verify capabilities and labels

---

## Updating Connections

### Update Credentials

If your provider credentials change (e.g., key rotation), update the connection:

```bash
curl -X POST https://api.primeflow.com/v1/connections \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: conn-paystack-update-001" \
  -d '{
    "id": "paystack_live",
    "provider": "paystack",
    "mode": "live",
    "status": "active",
    "credentials": {
      "secret_key": "sk_live_new_xxx",
      "public_key": "pk_live_new_xxx"
    }
  }'
```

**Note**: Using POST with existing ID performs an update (upsert).

### Update Labels

Labels help Primeflow route intelligently:

```bash
curl -X PATCH https://api.primeflow.com/v1/connections/paystack_live/labels \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -d '{
    "labels": ["primary", "ghana", "high-volume"]
  }'
```

**Label Examples**:
- `primary`: Main connection for routing
- `fallback`: Backup connection
- `ghana`: Country-specific connection
- `high-volume`: For high-volume transactions
- `low-fee`: Connection with lower fees

### Enable/Disable Connection

Temporarily disable a connection without deleting it:

```bash
curl -X PATCH https://api.primeflow.com/v1/connections/paystack_live/status \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -d '{
    "status": "inactive"
  }'
```

**Use Cases**:
- **Maintenance**: Disable during provider maintenance
- **Issues**: Temporarily disable problematic connections
- **Testing**: Disable production connections during testing

---

## Connection Health

Each connection tracks performance metrics to help Primeflow route intelligently.

### Health Metrics

| Metric | Description | What It Means |
|--------|-------------|---------------|
| `health_score` | Success rate (0.0 - 1.0) | 0.98 = 98% success rate |
| `total_calls` | Total API calls | Track usage |
| `successful_calls` | Successful calls | Measure reliability |
| `failed_calls` | Failed calls | Identify issues |
| `avg_latency_ms` | Average response time | Measure performance |
| `last_success_at` | Last successful call | Check if connection is working |
| `last_failure_at` | Last failed call | Identify recent issues |

### Using Health Data

**High health score (0.95+)**: Connection is reliable, will be preferred for routing

**Low health score (&lt;0.90)**: Connection may have issues, Primeflow will prefer alternatives

**Recent failures**: Check `last_failure_at` to see if issues are ongoing

---

## Audit Logs

Track all changes to connections for compliance and debugging:

```bash
curl https://api.primeflow.com/v1/connections/paystack_live/audit \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "logs": [
    {
      "id": "log_123",
      "action": "created",
      "actor": "user_456",
      "changes": { "status": "active" },
      "created_at": "2025-02-10T10:00:00Z"
    },
    {
      "id": "log_124",
      "action": "updated",
      "actor": "user_456",
      "changes": { "credentials": "updated" },
      "created_at": "2025-02-15T14:30:00Z"
    }
  ]
}
```

**Use Cases**:
- **Compliance**: Track who changed what and when
- **Debugging**: Identify when issues started
- **Security**: Monitor unauthorized changes

---

## Routing with Connections

Connections work seamlessly with Primeflow's routing system.

### Automatic Routing

Primeflow automatically selects the best connection based on:
- **Health scores**: Prefer connections with higher success rates
- **Capabilities**: Match payment method and country requirements
- **Labels**: Use routing hints from labels
- **Availability**: Only route to active connections

### Manual Routing

Force a specific connection for a payment:

```bash
curl -X POST https://api.primeflow.com/v1/payments/intents \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -d '{
    "amount": 5000,
    "currency": "GHS",
    "method": "momo",
    "country": "GH",
    "connection_id": "hubtel_live"
  }'
```

**Use Cases**:
- **Testing**: Test specific connections
- **Provider preference**: Force specific provider for certain payments
- **A/B testing**: Compare provider performance

### Routing Rules

For advanced control, use [Routing Rules](./routing-rules) to explicitly route payments from specific countries or methods to specific connections.

**Example**: Route all European card payments to Stripe:

```bash
curl -X POST https://api.primeflow.com/v1/routing-rules \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -d '{
    "name": "Europe Cards → Stripe",
    "countries": ["GB", "DE", "FR", "ES", "IT"],
    "methods": ["card"],
    "connection_id": "stripe_live",
    "priority": 10,
    "fallback_to_default": true,
    "enabled": true
  }'
```

---

## Best Practices

### 1. Multiple Connections

**Don't rely on a single connection**. Connect multiple providers for:
- **Failover**: If one fails, others continue working
- **Better rates**: Compare and optimize fees
- **Higher success**: Different providers excel in different scenarios

**Example Setup**:
- **Primary**: Paystack (Ghana)
- **Backup**: Hubtel (Ghana mobile money)
- **International**: Stripe (Global cards)

### 2. Use Descriptive IDs

**Good**: `paystack_gh_live`, `hubtel_gh_backup`

**Bad**: `conn1`, `test`, `paystack`

### 3. Test Before Production

Always test connections in sandbox mode first:
1. Create sandbox connection
2. Test with sandbox API keys
3. Verify payments work
4. Create live connection

### 4. Monitor Health Scores

Regularly check health scores:
- **High scores**: Connection is working well
- **Low scores**: Investigate issues
- **Declining scores**: May indicate problems

### 5. Rotate Credentials

Update credentials periodically:
- **Security**: Rotate keys every 90 days
- **Compliance**: Meet security requirements
- **Best practice**: Follow provider recommendations

### 6. Use Labels Strategically

Labels help Primeflow route intelligently:
- **`primary`**: Mark your main connection
- **`fallback`**: Mark backup connections
- **Country codes**: `ghana`, `nigeria` for country-specific routing
- **Method tags**: `card`, `momo` for method-specific routing

### 7. Keep Connections Active

Only disable connections when:
- **Maintenance**: Provider is doing maintenance
- **Issues**: Connection has persistent problems
- **Testing**: Temporarily disable during testing

**Don't disable** just because you have backups - Primeflow uses multiple connections for better success rates.

---

## Security

### Credential Storage

- **Encrypted at rest**: All credentials encrypted using industry-standard encryption
- **Never exposed**: Credentials never appear in logs or responses
- **Access control**: Only authorized API keys can manage connections
- **Audit trail**: All changes logged for security compliance

### Best Practices

1. **Use environment variables**: Never hardcode credentials
2. **Rotate regularly**: Update credentials every 90 days
3. **Limit access**: Only give connection management access to trusted team members
4. **Monitor changes**: Review audit logs regularly
5. **Use scopes**: Limit API key scopes to minimum required

---

## Troubleshooting

### Connection Not Working

1. **Check status**: Is connection `active`?
2. **Verify credentials**: Test connection with `/test` endpoint
3. **Check health**: Review health score and recent failures
4. **Provider status**: Check provider's status page
5. **Contact support**: If issues persist

### Low Health Score

1. **Review failures**: Check `last_failure_at` and failure reasons
2. **Provider issues**: Check if provider is experiencing issues
3. **Credential problems**: Verify credentials are correct
4. **Network issues**: Check for network connectivity problems

### Payment Routing to Wrong Connection

1. **Check routing rules**: Review any routing rules that might override defaults
2. **Verify capabilities**: Ensure connection supports the payment method/country
3. **Check labels**: Review connection labels for routing hints
4. **Health scores**: Lower health scores may cause Primeflow to prefer alternatives

---

## Next Steps

<Cards columns={2}>
  <Card
    title="Payments"
    href="/docs/primeflow/docs/payments"
    icon={<CreditCard />}
  >
    Use your connected providers to start charging customers.
  </Card>
  <Card
    title="Routing Rules"
    href="/docs/primeflow/docs/routing-rules"
    icon={<Shuffle />}
  >
    Steer traffic to the best connection by method, country, or priority.
  </Card>
  <Card
    title="Fraud Policies"
    href="/docs/primeflow/docs/fraud-policies"
    icon={<ShieldCheck />}
  >
    Protect routes with velocity limits, blocklists, and risk controls.
  </Card>
  <Card
    title="Webhooks"
    href="/docs/primeflow/docs/webhooks"
    icon={<Webhook />}
  >
    Track connection events and routing outcomes in real time.
  </Card>
</Cards>
