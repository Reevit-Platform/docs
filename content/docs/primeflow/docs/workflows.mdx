---
title: Workflows
description: Automate actions triggered by payment events — send emails, SMS, or notifications
icon: Workflow
---

import { Webhook, CreditCard, Repeat, Link } from "lucide-react"

# Workflows

Automate actions triggered by payment events. Configure workflows in your Primeflow dashboard to automatically send emails, SMS, notifications, or trigger webhooks when specific payment events occur.

![Workflow Builder](/images/workflows/builder-diagram.svg)

## Why Workflows?

### The Challenge

Managing customer communications manually is time-consuming and error-prone:

- **Payment receipts**: Send confirmation emails after every successful payment
- **Failed payments**: Notify customers when payments fail
- **Subscription events**: Welcome emails, renewal reminders, cancellation confirmations
- **Team alerts**: Notify your team via Slack/Discord when important events happen
- **Data sync**: Update CRM, spreadsheets, or databases automatically

**Without workflows**, you'd need to:
- Build webhook handlers for every event
- Write code for each integration (email, SMS, Slack, etc.)
- Handle failures and retries manually
- Maintain multiple integrations

**Result**: Weeks of development, ongoing maintenance, and missed opportunities for automation.

### The Solution

Primeflow workflows let you:
- **Visual builder**: Create workflows visually in the dashboard (no code required)
- **Multiple integrations**: Connect your own email/SMS/notification providers (BYOK)
- **Templates**: Reuse message templates across workflows
- **Conditions**: Filter events with flexible conditions
- **Automatic execution**: Workflows run automatically when events match

**Result**: Set up automation in minutes, not weeks.

---

## How Workflows Work

### The Workflow Lifecycle

```
1. Event Occurs → 2. Check Conditions → 3. Execute Actions → 4. Log Execution
```

1. **Event Occurs**: Payment succeeds, fails, or subscription is created
2. **Check Conditions**: Primeflow evaluates workflow conditions (amount, currency, method, etc.)
3. **Execute Actions**: If conditions match, actions run (send email, SMS, webhook, etc.)
4. **Log Execution**: All executions are logged for monitoring and debugging

### Key Concepts

- **Trigger**: The event that starts the workflow (e.g., `payment.succeeded`) — *optional*, workflows can be action-only
- **Conditions**: Filters that determine if the workflow should run
- **Actions**: What the workflow does (send email, SMS, WhatsApp, webhook, etc.)
- **Integrations**: Your connected email/SMS/WhatsApp/notification providers
- **Templates**: Reusable message templates with variables

---

## Setting Up Workflows

### Via Dashboard (Recommended)

1. Go to **Workflows** in your Primeflow dashboard
2. Click **Create Workflow**
3. Select a **trigger** (optional — e.g., "Payment succeeded")
4. Add **conditions** (optional) to filter events
5. Add **actions** (e.g., "Send email", "Send WhatsApp")
6. Configure action details (select integration, template, recipient)
7. **Publish** the workflow

> **Note**: Triggers are optional. You can create workflows without triggers for manual execution or scheduled runs.

**Benefits**:
- Visual workflow builder
- No code required
- See workflow execution history
- Easy to test and iterate

### Via API

You can also create workflows programmatically via the API (see examples below).

---

## Integrations

Connect your own messaging providers. Primeflow uses a "Bring Your Own Key" (BYOK) model, so you maintain direct relationships with providers while benefiting from unified workflow automation.

![Integrations](/images/workflows/integrations-banner.svg)

### Supported Providers

| Type | Providers | Use Case |
|------|-----------|----------|
| **Email** | Resend, SendGrid, Postmark, Mailgun, AWS SES, Brevo | Transactional emails, receipts, notifications |
| **SMS** | Twilio, Africa's Talking, Termii, Hubtel SMS, MessageBird | SMS notifications, OTPs, alerts |
| **WhatsApp** | WhatsApp Business API, Twilio WhatsApp, MessageBird WhatsApp | Customer messaging, notifications, support |
| **Notifications** | Slack, Discord, Microsoft Teams, Custom Webhook | Team alerts, channel notifications |

### Create Integration

**Via Dashboard**:
1. Go to **Workflows → Integrations**
2. Click **Add Integration**
3. Select provider type (Email, SMS, or Notification)
4. Choose provider (e.g., Resend, Twilio, Slack)
5. Enter credentials (API keys, webhook URLs, etc.)
6. Configure settings (from email, sender ID, channel, etc.)
7. Save integration

**Via API**:

```bash
curl -X POST https://api.primeflow.com/v1/workflows/integrations \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: integ-resend-001" \
  -d '{
    "type": "email",
    "provider": "resend",
    "name": "Production Email",
    "credentials": {
      "api_key": "re_xxx"
    },
    "config": {
      "from_email": "noreply@yourapp.com",
      "from_name": "Your App"
    }
  }'
```

### Integration Types

**Email Integrations**:
- **Resend**: Modern email API, great for developers
- **SendGrid**: Enterprise email delivery
- **Postmark**: Transactional email specialist
- **Mailgun**: Email API with domain management
- **AWS SES**: Cost-effective at scale
- **Brevo**: Marketing and transactional email

**SMS Integrations**:
- **Twilio**: Global SMS platform
- **Africa's Talking**: African-focused messaging
- **Termii**: African messaging platform
- **Hubtel SMS**: Ghana messaging
- **MessageBird**: Global communications

**WhatsApp Integrations**:
- **WhatsApp Business API**: Direct Meta WhatsApp Business API integration
- **Twilio WhatsApp**: WhatsApp messaging via Twilio
- **MessageBird WhatsApp**: WhatsApp via MessageBird

**Notification Integrations**:
- **Slack**: Team messaging and collaboration
- **Discord**: Community and team chat
- **Microsoft Teams**: Enterprise collaboration
- **Custom Webhook**: Send to any HTTP endpoint

### List Integrations

```bash
curl https://api.primeflow.com/v1/workflows/integrations \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "integrations": [
    {
      "id": "integ_abc123",
      "type": "email",
      "provider": "resend",
      "name": "Production Email",
      "is_default": true,
      "created_at": "2025-02-10T10:00:00Z"
    }
  ]
}
```

### Set Default Integration

Set a default integration for each type (email, SMS, notification). If no integration is specified in an action, the default is used.

```bash
curl -X POST https://api.primeflow.com/v1/workflows/integrations/integ_abc123/default \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

---

## Templates

Create reusable message templates with variables. Templates make it easy to maintain consistent messaging across workflows.

### Variable Syntax

Use `{{variable_name}}` for dynamic content:

```
Hello {{customer_name}},

Your payment of {{amount}} {{currency}} was successful.

Payment ID: {{payment_id}}
Order ID: {{order_id}}

Thank you for your business!
```

### Available Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `{{customer_id}}` | Customer identifier | `cust_456` |
| `{{customer_name}}` | Customer name (if available) | `John Doe` |
| `{{customer_email}}` | Customer email | `john@example.com` |
| `{{amount}}` | Payment amount (formatted) | `GHS 99.00` |
| `{{currency}}` | Currency code | `GHS` |
| `{{payment_id}}` | Payment ID | `pay_xyz789` |
| `{{status}}` | Payment status | `succeeded`, `failed` |
| `{{provider}}` | PSP name | `paystack`, `hubtel` |
| `{{order_id}}` | From payment metadata | `ord_12345` |
| `{{metadata.*}}` | Any metadata field | `{{metadata.tier}}` |

### Create Template

**Via Dashboard**:
1. Go to **Workflows → Templates**
2. Click **Create Template**
3. Select type (Email, SMS, or Notification)
4. Enter name and content
5. Use variables for dynamic content
6. Save template

**Via API**:

```bash
curl -X POST https://api.primeflow.com/v1/workflows/templates \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: tmpl-receipt-001" \
  -d '{
    "type": "email",
    "name": "Payment Receipt",
    "subject": "Payment Confirmed - {{order_id}}",
    "body": "Hello {{customer_name}},\n\nYour payment of {{amount}} {{currency}} was successful.\n\nPayment ID: {{payment_id}}\nOrder ID: {{order_id}}\n\nThank you!"
  }'
```

### List Templates

```bash
curl https://api.primeflow.com/v1/workflows/templates \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

---

## Workflow Rules

Define automation triggers and actions. Workflows run automatically when events match your configured triggers and conditions.

### Triggers

Available triggers based on payment and subscription events:

| Trigger | Description | When It Fires |
|---------|-------------|---------------|
| `payment.created` | Payment intent created | When a payment intent is created via API |
| `payment.succeeded` | Payment succeeded | When a payment completes successfully |
| `payment.failed` | Payment failed | When a payment attempt fails |
| `payment.canceled` | Payment canceled | When a payment is canceled |
| `subscription.created` | Subscription created | When a new subscription is created |
| `invoice.failed` | Invoice payment failed | When a subscription invoice payment fails |

### Conditions

Filter which events trigger the workflow. Conditions are optional but powerful for targeting specific scenarios.

**Available Conditions**:

| Condition | Type | Description | Example |
|-----------|------|-------------|---------|
| `amount_gte` | number | Amount greater than or equal | `10000` (GHS 100.00) |
| `amount_lte` | number | Amount less than or equal | `50000` (GHS 500.00) |
| `currency` | string | Currency code | `GHS`, `NGN`, `USD` |
| `method` | string | Payment method | `card`, `momo`, `bank` |
| `metadata.*` | string | Metadata field | `metadata.tier` = `premium` |

**Example Conditions**:

```json
{
  "conditions": {
    "amount_gte": 10000,
    "currency": "GHS",
    "method": "card",
    "metadata.tier": "premium"
  }
}
```

**Use Cases**:
- **High-value payments**: Send special receipt for payments over GHS 1000
- **Specific currencies**: Different workflows for GHS vs NGN payments
- **Payment methods**: Special handling for mobile money vs card payments
- **Customer segments**: Different workflows for premium vs basic customers

### Actions

Available actions you can trigger in workflows:

| Action | Description | Use Case |
|--------|-------------|----------|
| `send_email` | Send email via integration | Payment receipts, confirmations |
| `send_sms` | Send SMS via integration | Payment notifications, OTPs |
| `send_whatsapp` | Send WhatsApp message | Customer notifications, support messages |
| `send_notification` | Send to Slack/Discord/Teams | Team alerts, channel notifications |
| `call_webhook` | POST to external URL | Custom integrations, data sync |
| `segment_track` | Track event in Segment | Analytics, customer tracking |
| `google_sheet_append` | Append row to Google Sheets | Data logging, reporting |
| `jira_ticket` | Create Jira issue | Support tickets, bug tracking |
| `linear_issue` | Create Linear issue | Task management, project tracking |
| `notion_page` | Create Notion page | Documentation, knowledge base |
| `airtable_record` | Create Airtable record | CRM, data management |
| `pagerduty_incident` | Open PagerDuty incident | Incident management, on-call alerts |
| `opsgenie_alert` | Open OpsGenie alert | Alerting, incident response |
| `hubspot_contact_update` | Upsert HubSpot contact | CRM updates, lead management |
| `salesforce_lead_update` | Create/update Salesforce lead | CRM updates, sales tracking |

### Create Workflow

**Via Dashboard**:
1. Go to **Workflows**
2. Click **Create Workflow**
3. Select trigger from Primeflow events
4. Add conditions (optional)
5. Add actions (drag and drop in visual builder)
6. Configure each action:
   - Select integration (or use default)
   - Select template (for email/SMS)
   - Configure recipient (use variables like `{{customer_email}}`)
7. Name and describe the workflow
8. **Publish** to activate

**Via API**:

```bash
curl -X POST https://api.primeflow.com/v1/workflows/rules \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123" \
  -H "Idempotency-Key: wf-receipt-001" \
  -d '{
    "name": "Send Payment Receipt",
    "description": "Email receipt on successful payment",
    "trigger": "payment.succeeded",
    "conditions": {
      "amount_gte": 1000
    },
    "actions": [
      {
        "type": "send_email",
        "integration_id": "integ_abc123",
        "template_id": "tmpl_xyz789",
        "to": "{{customer_email}}"
      }
    ],
    "enabled": true
  }'
```

### Action Configuration

**Email Action**:
```json
{
  "type": "send_email",
  "integration_id": "integ_abc123",
  "template_id": "tmpl_xyz789",
  "to": "{{customer_email}}",
  "cc": ["admin@yourapp.com"],
  "reply_to": "support@yourapp.com"
}
```

**SMS Action**:
```json
{
  "type": "send_sms",
  "integration_id": "integ_twilio",
  "template_id": "tmpl_sms_receipt",
  "to": "{{customer_phone}}"
}
```

**WhatsApp Action**:
```json
{
  "type": "send_whatsapp",
  "integration_id": "integ_whatsapp_business",
  "template_name": "payment_receipt",
  "to": "{{customer_phone}}"
}
```

**Webhook Action**:
```json
{
  "type": "call_webhook",
  "webhook_url": "https://yourapp.com/webhooks/payment",
  "method": "POST",
  "headers": {
    "Authorization": "Bearer token_xxx"
  }
}
```

**Slack/Discord/Teams Action**:
```json
{
  "type": "send_notification",
  "integration_id": "integ_slack",
  "message": "Payment {{payment_id}} succeeded: {{amount}} {{currency}}"
}
```

### List Workflows

```bash
curl https://api.primeflow.com/v1/workflows/rules \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "rules": [
    {
      "id": "wf_abc123",
      "name": "Send Payment Receipt",
      "trigger": "payment.succeeded",
      "enabled": true,
      "executions_count": 1250,
      "created_at": "2025-02-10T10:00:00Z"
    }
  ]
}
```

### Enable/Disable Workflow

Temporarily disable a workflow without deleting it:

```bash
# Disable
curl -X POST https://api.primeflow.com/v1/workflows/rules/wf_abc123/disable \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"

# Enable
curl -X POST https://api.primeflow.com/v1/workflows/rules/wf_abc123/enable \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

---

## Executions

View workflow execution history to monitor performance and debug issues.

### List Executions

```bash
curl "https://api.primeflow.com/v1/workflows/executions?limit=20" \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "executions": [
    {
      "id": "exec_123",
      "workflow_id": "wf_abc123",
      "workflow_name": "Send Payment Receipt",
      "trigger": "payment.succeeded",
      "payment_id": "pay_xyz789",
      "status": "completed",
      "created_at": "2025-02-10T10:05:00Z"
    }
  ]
}
```

### Execution Statuses

- **`pending`**: Execution queued, waiting to start
- **`running`**: Actions are currently executing
- **`completed`**: All actions completed successfully
- **`failed`**: One or more actions failed

### Get Action Results

View detailed results for each action in an execution:

```bash
curl https://api.primeflow.com/v1/workflows/executions/exec_123/actions \
  -H "X-Primeflow-Key: pfk_live_xxx" \
  -H "X-Org-Id: org_123"
```

**Response:**
```json
{
  "actions": [
    {
      "type": "send_email",
      "status": "success",
      "provider_response": {
        "message_id": "msg_abc",
        "provider": "resend"
      },
      "executed_at": "2025-02-10T10:05:01Z"
    },
    {
      "type": "call_webhook",
      "status": "failed",
      "error": "Connection timeout",
      "executed_at": "2025-02-10T10:05:02Z"
    }
  ]
}
```

---

## Common Workflow Patterns

### Payment Receipt

**Trigger**: `payment.succeeded`  
**Action**: Send email with receipt template

**Use Case**: Automatically send payment confirmation emails to customers.

### Failed Payment Notification

**Trigger**: `payment.failed`  
**Actions**: 
1. Send email to customer with retry instructions
2. Notify team via Slack

**Use Case**: Keep customers informed and alert your team to payment issues.

### High-Value Payment Alert

**Trigger**: `payment.succeeded`  
**Conditions**: `amount_gte: 100000` (GHS 1,000+)  
**Actions**: 
1. Send email receipt
2. Notify finance team via Slack
3. Create Jira ticket for review

**Use Case**: Flag high-value payments for manual review.

### Subscription Welcome

**Trigger**: `subscription.created`  
**Actions**: 
1. Send welcome email
2. Update HubSpot contact
3. Track event in Segment

**Use Case**: Onboard new subscribers and sync to CRM/analytics.

### Invoice Payment Failed

**Trigger**: `invoice.failed`  
**Actions**: 
1. Send email to customer
2. Send SMS reminder
3. Create support ticket

**Use Case**: Recover failed subscription payments with multi-channel communication.

---

## Best Practices

### 1. Test First

- **Use sandbox mode**: Test workflows with test payments before going live
- **Start simple**: Begin with basic triggers, add conditions later
- **Monitor executions**: Check execution logs to verify workflows work as expected

### 2. Use Templates

- **Reuse templates**: Create templates for common messages (receipts, confirmations)
- **Maintain consistency**: Use templates to ensure consistent messaging
- **Easy updates**: Update template once, changes apply to all workflows using it

### 3. Set Default Integrations

- **Simplify configuration**: Set default integrations to avoid specifying them in every action
- **Easy switching**: Change default to switch providers without updating workflows

### 4. Monitor Executions

- **Check regularly**: Review execution logs for failures
- **Set up alerts**: Use workflows to alert on workflow failures
- **Debug issues**: Use execution details to troubleshoot problems

### 5. Use Conditions Wisely

- **Be specific**: Use conditions to target the right events
- **Test conditions**: Verify conditions work as expected with test events
- **Don't over-filter**: Avoid conditions that are too restrictive

### 6. Handle Failures

- **Retry logic**: Some actions automatically retry on failure
- **Fallback actions**: Consider fallback actions if primary action fails
- **Error notifications**: Set up alerts for workflow failures

---

## Troubleshooting

### Workflow Not Triggering

1. **Check trigger**: Verify the trigger matches the event type
2. **Check conditions**: Ensure conditions aren't too restrictive
3. **Check enabled status**: Verify workflow is enabled/published
4. **Check execution logs**: Review execution history for errors

### Action Failing

1. **Check integration**: Verify integration credentials are correct
2. **Check template**: Ensure template exists and variables are correct
3. **Check recipient**: Verify recipient address/phone is valid
4. **Check provider status**: Verify provider (Resend, Twilio, etc.) is operational

### Email Not Sending

1. **Check integration**: Verify email integration is configured correctly
2. **Check from address**: Ensure "from" email is verified with provider
3. **Check spam**: Check spam folder, verify SPF/DKIM records
4. **Check provider logs**: Review provider dashboard for delivery status

---

## Next Steps

<Cards columns={2}>
  <Card
    title="Payments"
    href="/docs/primeflow/docs/payments"
    icon={<CreditCard />}
  >
    Map workflow triggers to each payment status and next action.
  </Card>
  <Card
    title="Subscriptions"
    href="/docs/primeflow/docs/subscriptions"
    icon={<Repeat />}
  >
    Automate renewal reminders, dunning nudges, and win-back flows.
  </Card>
  <Card
    title="Webhooks"
    href="/docs/primeflow/docs/webhooks"
    icon={<Webhook />}
  >
    Ingest events reliably and pass them to workflows or third-parties.
  </Card>
  <Card
    title="Connections"
    href="/docs/primeflow/docs/connections"
    icon={<Link />}
  >
    Keep provider integrations healthy so actions and messages stay accurate.
  </Card>
</Cards>
