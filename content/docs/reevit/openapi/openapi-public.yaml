openapi: 3.0.3
info:
  title: Reevit API
  version: 0.3.0
  description: >
    Reevit is a unified payments, billing, and orchestration API for Africa.


    **Model:** BYOK (Bring-Your-Own-Key). Merchants connect their own PSP
    accounts.

    **MVP Providers:** Paystack, Hubtel, Flutterwave, Monnify, M-Pesa, Stripe
    (cards including Apple Pay/Google Pay via card rails).


    **Ghana routing (primary):**
      - MoMo: Hubtel → Paystack → Flutterwave → M-Pesa
      - Cards: Paystack → Hubtel → Flutterwave
      - Bank/USSD: Paystack → Flutterwave

    Nigeria cards default to Paystack → Flutterwave. Monnify handles bank
    transfers.


    ## Authentication


    Reevit supports two authentication methods:


    ### 1. API Key Authentication (Server-to-Server)

    For server-to-server API calls, use API key authentication:

    ```

    X-Reevit-Key: pfk_your_org_id.your_secret_key

    X-Org-Id: your_org_id

    ```


    ### 2. Session Authentication (Dashboard Users)

    For dashboard user authentication, use magic links or OAuth:

    - **Magic Link**: Request a magic link via `/auth/magic-link`, then verify
    via `/auth/verify`

    - **OAuth**: Use `/auth/oauth/login?provider=google` or
    `/auth/oauth/login?provider=github`

    - Sessions are automatically created and stored as cookies
    (`reevit_session`)

    - Sessions can also be used as Bearer tokens: `Authorization: Bearer
    <session_token>`


    ### 3. Two-Factor Authentication (2FA)

    Users can enable TOTP-based 2FA for enhanced security:

    1. Setup: `POST /auth/2fa/setup` - Get secret and QR code

    2. Enable: `POST /auth/2fa/enable` - Verify and enable with TOTP code

    3. Login: Include `code` parameter when verifying magic link


    ### 4. WebAuthn/Passkeys (Passwordless Authentication)

    Users can register and authenticate using WebAuthn/Passkeys for passwordless
    authentication:

    1. Register: `POST /auth/webauthn/register/begin` → Complete registration →
    `POST /auth/webauthn/register/finish`

    2. Authenticate: `POST /auth/webauthn/authenticate/begin` → Complete
    authentication → `POST /auth/webauthn/authenticate/finish`

    3. Manage: `GET /auth/webauthn/credentials` to list, `DELETE
    /auth/webauthn/credentials` to remove


    **Note:** WebAuthn requires HTTPS in production and proper browser support.


    ## Rate Limiting


    - Magic link requests: 3 per 15 minutes per email

    - IP-based: 10 requests per 15 minutes per IP

    - Rate limit headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`,
    `X-RateLimit-Reset`


    ## Idempotency


    Mutating operations support idempotency via `Idempotency-Key` header. Same
    key = same result.


    ## Webhooks


    Webhooks are signed by providers. Verify signatures before processing.


    Provider-specific webhook setup:
      - **Stripe:** configure the Reevit webhook URL in Stripe; store the signing secret in connection credentials as `stripe_webhook_secret` (aliases: `webhook_secret`, `signing_secret`). PaymentIntent metadata must include `org_id`, `connection_id`, `payment_id` so events can be linked.
      - **Paystack/Hubtel/Flutterwave/Monnify/M-Pesa:** already supported; store the provider’s webhook secret/key in the connection credentials as documented in the dashboard.
servers:
  - url: http://localhost:8081
    description: Local development server
  - url: https://api.reevit.com
    description: Production server
security:
  - ApiKeyAuth: []
paths:
  /v1/connections:
    get:
      summary: List PSP connections for the calling org (BYOK)
      operationId: listConnections
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: label
          in: query
          required: false
          schema:
            type: string
          description: >-
            Filter connections that include the specified label
            (case-insensitive)
        - name: provider
          in: query
          required: false
          schema:
            type: string
          description: Filter connections by provider (case-insensitive)
        - name: status
          in: query
          required: false
          schema:
            type: string
          description: Filter connections by status (active or inactive)
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
          description: Maximum number of connections to return
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
          description: >-
            Number of connections to skip before starting to collect the result
            set
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConnectionsListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create or update a PSP connection (BYOK)
      operationId: upsertConnection
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectionCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/labels:
    get:
      summary: List connection labels with counts
      operationId: listConnectionLabelStats
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConnectionLabelStat'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/{id}:
    get:
      summary: Get a connection by ID
      operationId: getConnection
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete a connection
      operationId: deleteConnection
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/{id}/audit:
    get:
      summary: List audit entries for a connection
      operationId: listConnectionAudit
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Audit entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConnectionAudit'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/{id}/labels:
    patch:
      summary: Update connection labels
      operationId: updateConnectionLabels
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectionLabelsRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/{id}/status:
    patch:
      summary: Update connection status
      operationId: updateConnectionStatus
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum:
                    - active
                    - inactive
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connection'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/connections/test:
    post:
      summary: >-
        Test a PSP connection using supplied credentials (encryption path +
        basic ping)
      operationId: testConnection
      tags:
        - Connections
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectionCreate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/billing/subscription:
    get:
      summary: Get current subscription, plan, and usage for the calling org
      operationId: getBillingSubscription
      tags:
        - Billing
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BillingSubscriptionResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Update subscription plan for the calling org
      operationId: updateBillingSubscription
      tags:
        - Billing
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSubscriptionRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrgSubscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/billing/plans:
    get:
      summary: List available billing plans
      operationId: listBillingPlans
      tags:
        - Billing
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BillingPlansResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/billing/usage:
    get:
      summary: Get usage for the calling org (mode-aware)
      operationId: getBillingUsage
      tags:
        - Billing
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: mode
          required: false
          schema:
            type: string
            enum:
              - sandbox
              - live
          description: >-
            Optional mode override for session users (defaults to principal
            mode)
        - in: query
          name: start
          required: false
          schema:
            type: string
            format: date-time
          description: Start of range (RFC3339). Defaults to start of current month.
        - in: query
          name: end
          required: false
          schema:
            type: string
            format: date-time
          description: End of range (RFC3339). Defaults to end of current month.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BillingUsageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/routing-rules:
    get:
      summary: List routing rules for the organization
      description: >
        Routing rules allow you to explicitly route payments from specific
        countries and/or payment methods

        to specific PSP connections. Rules are evaluated by priority (highest
        first). If no rule matches,

        default routing logic is used.
      operationId: listRoutingRules
      tags:
        - Routing Rules
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  rules:
                    type: array
                    items:
                      $ref: '#/components/schemas/RoutingRule'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create a routing rule
      description: >
        Create a new routing rule to route payments from specific
        countries/methods to a specific connection.

        Rules are evaluated by priority (highest first).
      operationId: createRoutingRule
      tags:
        - Routing Rules
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutingRuleCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoutingRule'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/routing-rules/{id}:
    get:
      summary: Get a routing rule by ID
      operationId: getRoutingRule
      tags:
        - Routing Rules
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoutingRule'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      summary: Update a routing rule
      operationId: updateRoutingRule
      tags:
        - Routing Rules
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoutingRuleUpdate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoutingRule'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete a routing rule
      operationId: deleteRoutingRule
      tags:
        - Routing Rules
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/intents:
    post:
      summary: >-
        Create a payment intent (idempotent; router picks connections by
        country/method)
      operationId: createPaymentIntent
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentIntentCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/intents/{id}:
    patch:
      summary: Update a pending payment intent before confirmation
      operationId: updatePaymentIntent
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentIntentUpdate'
      responses:
        '200':
          description: Updated intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments:
    get:
      summary: List payments for the calling org (most recent first)
      operationId: listPayments
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 200
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
        - in: query
          name: status
          schema:
            type: string
          description: Filter by payment status
        - in: query
          name: customer_id
          schema:
            type: string
          description: Filter by customer ID
        - in: query
          name: provider
          schema:
            type: string
          description: Filter by payment provider
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PaymentSummary'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/stats:
    get:
      summary: Get aggregated payment statistics for the organization
      operationId: getPaymentStats
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum:
              - day
              - week
              - month
            default: day
          description: Time range to aggregate over
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/stats/series:
    get:
      summary: Get payment statistics over time
      operationId: getPaymentStatsSeries
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum:
              - day
              - week
              - month
            default: day
          description: Time range to aggregate over
        - name: granularity
          in: query
          required: false
          schema:
            type: string
            enum:
              - day
              - week
            default: day
          description: Bucket size for time series
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatsSeriesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/stats/latency:
    get:
      summary: Get payment latency histogram buckets
      operationId: getPaymentLatencyStats
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum:
              - day
              - week
              - month
            default: day
          description: Time range to aggregate over
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentLatencyResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/stats/errors:
    get:
      summary: Get payment error breakdown
      operationId: getPaymentErrorStats
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum:
              - day
              - week
              - month
            default: day
          description: Time range to aggregate over
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentErrorsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/export:
    get:
      summary: Export payments for the calling org
      operationId: exportPayments
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: format
          in: query
          schema:
            type: string
            enum:
              - json
              - csv
            default: json
          description: Export format
        - in: query
          name: status
          schema:
            type: string
          description: Filter by payment status
        - in: query
          name: customer_id
          schema:
            type: string
          description: Filter by customer ID
        - in: query
          name: provider
          schema:
            type: string
          description: Filter by payment provider
      responses:
        '200':
          description: Exported payments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentExportResponse'
            text/csv:
              schema:
                type: string
                description: CSV file with payments
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/refunds:
    get:
      summary: List refunds for the calling org
      operationId: listRefunds
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Refund'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/refunds/{refund_id}:
    get:
      summary: Get a refund by ID
      operationId: getRefund
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: refund_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/bulk/refund:
    post:
      summary: Bulk refund payments
      operationId: bulkRefundPayments
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkRefundRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkOperationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/bulk/status:
    post:
      summary: Bulk update payment status
      operationId: bulkUpdatePaymentStatus
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BulkStatusUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BulkOperationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/{id}:
    get:
      summary: Get a payment by ID
      operationId: getPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/{id}/refund:
    post:
      summary: Refund a payment
      operationId: refundPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefundRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/{id}/refunds:
    get:
      summary: List refunds for a payment
      operationId: listRefundsByPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Refund'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/{id}/status_history:
    get:
      summary: List status transitions for a payment
      operationId: listPaymentStatusHistory
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PaymentStatusHistoryItem'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/fees:
    get:
      summary: Summarize payment fees
      operationId: listPaymentFees
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: since
          schema:
            type: string
            format: date-time
          description: Optional inclusive start timestamp
        - in: query
          name: until
          schema:
            type: string
            format: date-time
          description: Optional inclusive end timestamp
        - in: query
          name: provider
          schema:
            type: string
        - in: query
          name: method
          schema:
            type: string
      responses:
        '200':
          description: Aggregated fee metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeeInsightsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/fees/{id}:
    get:
      summary: Get the fee detail for a payment
      operationId: getPaymentFeeDetail
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fee detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeeDetail'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/payments/{id}/confirm:
    post:
      summary: Confirm payment status with provider
      operationId: confirmPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
  /v1/payments/{id}/retry:
    post:
      summary: Retry a failed payment
      operationId: retryPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
  /v1/payments/{id}/cancel:
    post:
      summary: Cancel a pending payment intent
      operationId: cancelPayment
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
  /v1/payments/disputes/{id}/resolve:
    post:
      summary: Resolve a payment dispute and capture annotations
      operationId: resolvePaymentDispute
      tags:
        - Payments
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisputeResolveRequest'
      responses:
        '200':
          description: Updated dispute
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentDispute'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/incoming/{provider}:
    post:
      summary: Ingest provider webhook payloads and normalize them
      operationId: ingestWebhook
      security: []
      tags:
        - Webhooks
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum:
              - paystack
              - hubtel
              - flutterwave
              - monnify
              - mpesa
              - stripe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Accepted
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/config:
    get:
      summary: Get webhook configuration for org
      operationId: getWebhookConfig
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookConfig'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create or update webhook configuration for org
      operationId: upsertWebhookConfig
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookConfigInput'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookConfig'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete webhook configuration for org
      operationId: deleteWebhookConfig
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: deleted
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/test:
    post:
      summary: Send a test webhook event to configured endpoint
      operationId: testWebhook
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '502':
          $ref: '#/components/responses/BadGateway'
  /v1/webhooks/outbound:
    get:
      summary: List outbound webhooks for org
      operationId: listOutboundWebhooks
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OutboundWebhook'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/outbound/{id}:
    get:
      summary: Get outbound webhook by ID
      operationId: getOutboundWebhook
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutboundWebhook'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/events:
    get:
      summary: List webhook events for org
      operationId: listWebhookEvents
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WebhookEvent'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/events/{id}:
    get:
      summary: Get webhook event by ID
      operationId: getWebhookEvent
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookEvent'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/webhooks/events/{event_id}/replay:
    post:
      summary: Replay a stored webhook event (idempotent, org-scoped)
      operationId: replayWebhookEvent
      tags:
        - Webhooks
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: event_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Replayed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: applied
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/policies/fraud:
    get:
      summary: Get stored fraud policy for the calling org
      operationId: getFraudPolicy
      tags:
        - Fraud
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FraudPolicy'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Upsert stored fraud policy for the calling org
      operationId: upsertFraudPolicy
      tags:
        - Fraud
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FraudPolicyInput'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FraudPolicy'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/policies/fraud/audit:
    get:
      summary: List fraud policy changes (most recent first)
      operationId: listFraudPolicyAudit
      tags:
        - Fraud
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 20
          description: Number of audit entries to return (max 200)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FraudPolicyAudit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/policies/retry:
    get:
      summary: Get retry policy for org or plan
      operationId: getRetryPolicy
      tags:
        - Retry Policies
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: plan_id
          schema:
            type: string
          description: Plan ID (empty for org-wide default)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetryPolicy'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create or update retry policy
      operationId: upsertRetryPolicy
      tags:
        - Retry Policies
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - delays
              properties:
                plan_id:
                  type: string
                  description: Plan ID (empty for org-wide default)
                delays:
                  type: array
                  items:
                    type: string
                  description: Array of delay durations (e.g., ["15m", "1h", "24h"])
                max_retries:
                  type: integer
                  description: Maximum number of retries (defaults to len(delays))
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetryPolicy'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      summary: Delete retry policy
      operationId: deleteRetryPolicy
      tags:
        - Retry Policies
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: plan_id
          schema:
            type: string
          description: Plan ID (empty for org-wide default)
      responses:
        '204':
          description: No Content
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/policies/retry/list:
    get:
      summary: List all retry policies for org
      operationId: listRetryPolicies
      tags:
        - Retry Policies
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RetryPolicy'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/api-keys:
    get:
      summary: List API keys for the calling org
      operationId: listAPIKeys
      tags:
        - API Keys
      parameters:
        - $ref: '#/components/parameters/XOrgId'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/APIKey'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create a new API key for the calling org
      operationId: createAPIKey
      tags:
        - API Keys
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APIKeyCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/APIKeyCreateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/api-keys/{id}:
    delete:
      summary: Revoke an API key
      operationId: revokeAPIKey
      tags:
        - API Keys
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: API key ID
      responses:
        '204':
          description: No Content
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/invoices:
    get:
      summary: List invoices for the calling org
      operationId: listInvoices
      tags:
        - Invoices
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
        - in: query
          name: status
          schema:
            type: string
            enum:
              - draft
              - due
              - paid
              - failed
              - canceled
        - in: query
          name: subscription_id
          schema:
            type: string
        - in: query
          name: created_after
          schema:
            type: string
            format: date-time
        - in: query
          name: created_before
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Invoice'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/invoices/{id}:
    get:
      summary: Get invoice by ID
      operationId: getInvoice
      tags:
        - Invoices
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      summary: Update invoice metadata
      operationId: updateInvoice
      tags:
        - Invoices
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                metadata:
                  type: object
                  additionalProperties: true
              required:
                - metadata
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/invoices/{id}/cancel:
    post:
      summary: Cancel a pending invoice
      operationId: cancelInvoice
      tags:
        - Invoices
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Optional cancellation reason for auditing
      responses:
        '200':
          description: Invoice canceled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/invoices/{id}/retry:
    post:
      summary: Manually retry a failed invoice
      operationId: retryInvoice
      tags:
        - Invoices
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '202':
          description: Retry accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/subscriptions:
    get:
      summary: List subscriptions for the calling org
      operationId: listSubscriptions
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - in: query
          name: status
          schema:
            type: string
            enum:
              - active
              - paused
              - canceled
          description: Filter by subscription status
        - in: query
          name: customer_id
          schema:
            type: string
          description: Filter by customer ID
        - in: query
          name: plan_id
          schema:
            type: string
          description: Filter by plan ID
        - in: query
          name: created_after
          schema:
            type: string
            format: date-time
          description: Filter by creation date (after)
        - in: query
          name: created_before
          schema:
            type: string
            format: date-time
          description: Filter by creation date (before)
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 200
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
    post:
      summary: Create a subscription
      operationId: createSubscription
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/subscriptions/{id}:
    get:
      summary: Get subscription by ID
      operationId: getSubscription
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
    patch:
      summary: Update subscription
      operationId: updateSubscription
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                plan_id:
                  type: string
                  description: New plan ID
                amount:
                  type: integer
                  description: New amount (in smallest currency unit)
                interval:
                  type: string
                  enum:
                    - monthly
                    - yearly
                  description: New billing interval
                metadata:
                  type: object
                  additionalProperties: true
                  description: Updated metadata
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/subscriptions/{id}/cancel:
    post:
      summary: Cancel a subscription
      operationId: cancelSubscription
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/subscriptions/{id}/resume:
    post:
      summary: Resume a paused subscription
      operationId: resumeSubscription
      tags:
        - Subscriptions
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /v1/workflows/integrations:
    get:
      summary: List messaging integrations
      description: >-
        List all BYOK integrations (email, SMS, notification providers) for the
        organization.
      operationId: listIntegrations
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: type
          in: query
          schema:
            type: string
            enum:
              - email
              - sms
              - notification
              - delivery
          description: Filter by integration type
      responses:
        '200':
          description: List of integrations
          content:
            application/json:
              schema:
                type: object
                properties:
                  integrations:
                    type: array
                    items:
                      $ref: '#/components/schemas/Integration'
    post:
      summary: Create a messaging integration
      description: Create a new BYOK integration with your own provider credentials.
      operationId: createIntegration
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIntegrationRequest'
      responses:
        '201':
          description: Integration created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Integration'
        '400':
          $ref: '#/components/responses/BadRequest'
  /v1/workflows/integrations/{id}:
    get:
      summary: Get an integration
      operationId: getIntegration
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Integration details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Integration'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update an integration
      operationId: updateIntegration
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  description: Integration type (email, sms, whatsapp, notification, etc.)
                  example: email
                provider:
                  type: string
                  description: Provider name (resend, sendgrid, twilio, etc.)
                  example: resend
                name:
                  type: string
                  description: Integration display name
                  example: Updated Resend Integration
                credentials:
                  type: object
                  description: Provider-specific credentials (will be encrypted)
                  additionalProperties: true
                  example:
                    api_key: re_new_api_key_here
                config:
                  type: object
                  description: Provider-specific configuration
                  additionalProperties: true
                  example:
                    from_email: noreply@example.com
              description: All fields are optional - only provided fields will be updated
      responses:
        '200':
          description: Integration updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Integration'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete an integration
      operationId: deleteIntegration
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Integration deleted
  /v1/workflows/integrations/{id}/default:
    post:
      summary: Set integration as default
      operationId: setDefaultIntegration
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Integration set as default
  /v1/workflows/templates:
    get:
      summary: List message templates
      operationId: listTemplates
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: type
          in: query
          schema:
            type: string
            enum:
              - email
              - sms
      responses:
        '200':
          description: List of templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  templates:
                    type: array
                    items:
                      $ref: '#/components/schemas/Template'
    post:
      summary: Create a message template
      operationId: createTemplate
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTemplateRequest'
      responses:
        '201':
          description: Template created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'
  /v1/workflows/templates/{id}:
    get:
      summary: Get a template
      operationId: getTemplate
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Template details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'
    put:
      summary: Update a template
      operationId: updateTemplate
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTemplateRequest'
      responses:
        '200':
          description: Template updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Template'
    delete:
      summary: Delete a template
      operationId: deleteTemplate
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Template deleted
  /v1/workflows/rules:
    get:
      summary: List workflow automation rules
      operationId: listWorkflows
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: trigger
          in: query
          schema:
            type: string
            enum:
              - payment.created
              - payment.success
              - payment.failed
              - payment.canceled
              - refund.created
              - refund.success
              - dispute.created
        - name: enabled
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                type: object
                properties:
                  workflows:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workflow'
    post:
      summary: Create a workflow automation rule
      operationId: createWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkflowRequest'
      responses:
        '201':
          description: Workflow created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
  /v1/workflows/rules/{id}:
    get:
      summary: Get a workflow
      operationId: getWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Workflow details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
    put:
      summary: Update a workflow
      operationId: updateWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkflowRequest'
      responses:
        '200':
          description: Workflow updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'
    delete:
      summary: Delete a workflow
      operationId: deleteWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Workflow deleted
  /v1/workflows/rules/{id}/enable:
    post:
      summary: Enable a workflow
      operationId: enableWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Workflow enabled
  /v1/workflows/rules/{id}/disable:
    post:
      summary: Disable a workflow
      operationId: disableWorkflow
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Workflow disabled
  /v1/workflows/executions:
    get:
      summary: List workflow executions
      operationId: listExecutions
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: workflow_id
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum:
              - pending
              - running
              - completed
              - failed
      responses:
        '200':
          description: List of executions
          content:
            application/json:
              schema:
                type: object
                properties:
                  executions:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkflowExecution'
  /v1/workflows/executions/{id}:
    get:
      summary: Get execution details
      operationId: getExecution
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Execution details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowExecution'
  /v1/workflows/executions/{id}/actions:
    get:
      summary: Get action results for an execution
      operationId: getActionResults
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Action results
          content:
            application/json:
              schema:
                type: object
                properties:
                  actions:
                    type: array
                    items:
                      $ref: '#/components/schemas/ActionResult'
  /v1/workflows/fraud-rules:
    get:
      summary: List custom fraud rules
      operationId: listFraudRules
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: rule_type
          in: query
          schema:
            type: string
            enum:
              - velocity
              - amount_threshold
              - country_block
              - card_bin
              - email_domain
              - ip_reputation
        - name: enabled
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of fraud rules
          content:
            application/json:
              schema:
                type: object
                properties:
                  fraud_rules:
                    type: array
                    items:
                      $ref: '#/components/schemas/FraudRule'
    post:
      summary: Create a custom fraud rule
      operationId: createFraudRule
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFraudRuleRequest'
      responses:
        '201':
          description: Fraud rule created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FraudRule'
  /v1/workflows/fraud-rules/{id}:
    get:
      summary: Get a fraud rule
      operationId: getFraudRule
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fraud rule details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FraudRule'
    delete:
      summary: Delete a fraud rule
      operationId: deleteFraudRule
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Fraud rule deleted
  /v1/workflows/fraud-rules/{id}/enable:
    post:
      summary: Enable a fraud rule
      operationId: enableFraudRule
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fraud rule enabled
  /v1/workflows/fraud-rules/{id}/disable:
    post:
      summary: Disable a fraud rule
      operationId: disableFraudRule
      tags:
        - Workflows
      parameters:
        - $ref: '#/components/parameters/XOrgId'
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fraud rule disabled
components:
  schemas:
    Money:
      type: object
      properties:
        amount:
          type: integer
        currency:
          type: string
      required:
        - amount
        - currency
    PaymentIntentCreate:
      type: object
      properties:
        amount:
          type: integer
          description: Amount in minor units
        currency:
          type: string
          description: ISO currency code (e.g.
          GHS: null
          NGN): null
        method:
          type: string
          description: Payment method (card
          mobile_money: null
          bank_transfer): null
        country:
          type: string
          description: ISO country (e.g.
          GH: null
          NG): null
        customer_id:
          type: string
        policy:
          type: object
          properties:
            prefer:
              type: array
              items:
                type: string
                enum:
                  - paystack
                  - hubtel
                  - flutterwave
                  - monnify
                  - mpesa
                  - stripe
            max_amount:
              type: integer
              description: >-
                Hard cap for this request; reject when amount exceeds this
                value.
            blocked_bins:
              type: array
              items:
                type: string
              description: 6-digit card BINs to block (case-insensitive).
            allowed_bins:
              type: array
              items:
                type: string
              description: If provided, only these 6-digit card BINs are allowed.
            velocity_max_per_minute:
              type: integer
              description: Maximum payment attempts per minute for the same customer_id.
        metadata:
          type: object
          additionalProperties: true
        description:
          type: string
      required:
        - amount
        - currency
        - method
    PaymentIntentUpdate:
      type: object
      description: >-
        Provide at least one field to update. Only pending/requires_action
        intents can be edited.
      minProperties: 1
      properties:
        amount:
          type: integer
          minimum: 1
        metadata:
          type: object
          additionalProperties: true
      additionalProperties: false
    PaymentIntent:
      type: object
      properties:
        id:
          type: string
        connection_id:
          type: string
        provider:
          type: string
          enum:
            - paystack
            - hubtel
            - flutterwave
            - monnify
            - mpesa
            - stripe
        status:
          type: string
          enum:
            - pending
            - requires_action
            - succeeded
            - failed
            - canceled
        client_secret:
          type: string
        amount:
          type: integer
        currency:
          type: string
        fee_amount:
          type: integer
        fee_currency:
          type: string
        net_amount:
          type: integer
    PaymentSummary:
      type: object
      properties:
        id:
          type: string
        connection_id:
          type: string
        provider:
          type: string
        method:
          type: string
        status:
          type: string
        amount:
          type: integer
        currency:
          type: string
        fee_amount:
          type: integer
        fee_currency:
          type: string
        net_amount:
          type: integer
        customer_id:
          type: string
        created_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
    RefundRequest:
      type: object
      properties:
        amount:
          type: integer
          format: int64
          description: >-
            Partial refund amount (in smallest currency unit). If omitted or 0,
            full refund.
        reason:
          type: string
          description: Reason for refund
    RefundPaymentInput:
      type: object
      properties:
        payment_id:
          type: string
        amount:
          type: integer
          format: int64
          description: >-
            Partial refund amount (in smallest currency unit). If omitted or 0,
            full refund.
        reason:
          type: string
      required:
        - payment_id
    PaymentExportResponse:
      type: object
      properties:
        payments:
          type: array
          items:
            $ref: '#/components/schemas/PaymentSummary'
        total:
          type: integer
    PaymentStatsResponse:
      type: object
      properties:
        totals:
          $ref: '#/components/schemas/PaymentStatsTotals'
        by_provider:
          type: array
          items:
            $ref: '#/components/schemas/PaymentBreakdown'
        by_method:
          type: array
          items:
            $ref: '#/components/schemas/PaymentBreakdown'
    PaymentStatsTotals:
      type: object
      properties:
        count:
          type: integer
          format: int64
        amount:
          type: integer
          format: int64
        succeeded:
          type: integer
          format: int64
        failed:
          type: integer
          format: int64
        refunded:
          type: integer
          format: int64
    PaymentBreakdown:
      type: object
      properties:
        key:
          type: string
        count:
          type: integer
          format: int64
        amount:
          type: integer
          format: int64
    PaymentStatsSeriesResponse:
      type: object
      properties:
        buckets:
          type: array
          items:
            $ref: '#/components/schemas/PaymentStatsBucket'
    PaymentStatsBucket:
      type: object
      properties:
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
        totals:
          $ref: '#/components/schemas/PaymentStatsTotals'
    PaymentLatencyResponse:
      type: object
      properties:
        buckets:
          type: array
          items:
            $ref: '#/components/schemas/PaymentLatencyBucket'
    PaymentLatencyBucket:
      type: object
      properties:
        bucket:
          type: string
        count:
          type: integer
          format: int64
    PaymentErrorsResponse:
      type: object
      properties:
        breakdown:
          type: array
          items:
            $ref: '#/components/schemas/PaymentErrorBreakdown'
    PaymentErrorBreakdown:
      type: object
      properties:
        error_message:
          type: string
        count:
          type: integer
          format: int64
    PaymentStatusHistoryItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
        from_status:
          type: string
        to_status:
          type: string
        source:
          type: string
        reason:
          type: string
        created_at:
          type: string
          format: date-time
    BulkRefundRequest:
      type: object
      properties:
        refunds:
          type: array
          items:
            $ref: '#/components/schemas/RefundPaymentInput'
      required:
        - refunds
    BulkStatusUpdateRequest:
      type: object
      properties:
        updates:
          type: object
          additionalProperties:
            type: string
      required:
        - updates
    BulkOperationResponse:
      type: object
      properties:
        results:
          type: object
          additionalProperties:
            type: object
            properties:
              success:
                type: boolean
              error:
                type: string
        total:
          type: integer
        success:
          type: integer
        failed:
          type: integer
    ConnectionCreate:
      type: object
      properties:
        id:
          type: string
        provider:
          type: string
          enum:
            - paystack
            - hubtel
            - flutterwave
            - monnify
            - mpesa
            - stripe
        mode:
          type: string
          enum:
            - sandbox
            - live
          default: live
        status:
          type: string
          enum:
            - active
            - inactive
          default: active
        credentials:
          type: object
          additionalProperties: true
        capabilities:
          type: object
          additionalProperties: true
        routing_hints:
          $ref: '#/components/schemas/RoutingHints'
        labels:
          type: array
          description: Up to 20 lowercase labels (letters, numbers, -, _)
          items:
            type: string
      required:
        - provider
        - credentials
    Connection:
      type: object
      properties:
        id:
          type: string
        provider:
          type: string
        mode:
          type: string
        status:
          type: string
        capabilities:
          type: object
          additionalProperties: true
        routing_hints:
          $ref: '#/components/schemas/RoutingHints'
        labels:
          type: array
          items:
            type: string
        fee_structure:
          $ref: '#/components/schemas/FeeStructure'
        total_calls:
          type: integer
          format: int64
        successful_calls:
          type: integer
          format: int64
        failed_calls:
          type: integer
          format: int64
        total_latency_ms:
          type: integer
          format: int64
        last_success_at:
          type: string
          format: date-time
        last_failure_at:
          type: string
          format: date-time
        health_score:
          type: number
          format: float
        health_status:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ConnectionsListResponse:
      type: object
      properties:
        connections:
          type: array
          items:
            $ref: '#/components/schemas/Connection'
        pagination:
          $ref: '#/components/schemas/Pagination'
    ConnectionLabelStat:
      type: object
      properties:
        label:
          type: string
        total:
          type: integer
        providers:
          type: object
          additionalProperties:
            type: integer
        statuses:
          type: object
          additionalProperties:
            type: integer
      required:
        - label
        - total
    ConnectionLabelsRequest:
      type: object
      properties:
        labels:
          type: array
          items:
            type: string
      required:
        - labels
    FeeStructure:
      type: object
      properties:
        percentage:
          type: number
          format: float
        fixed:
          type: integer
          format: int64
        per_method:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/MethodFee'
        per_currency:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/CurrencyFee'
    MethodFee:
      type: object
      properties:
        percentage:
          type: number
          format: float
        fixed:
          type: integer
          format: int64
    CurrencyFee:
      type: object
      properties:
        percentage:
          type: number
          format: float
        fixed:
          type: integer
          format: int64
    ConnectionAudit:
      type: object
      properties:
        id:
          type: integer
          format: int64
        actor_id:
          type: string
        action:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
    RoutingHints:
      type: object
      properties:
        country_preference:
          type: array
          items:
            type: string
            description: ISO 3166-1 alpha-2 country code
        method_bias:
          type: object
          additionalProperties:
            type: string
            enum:
              - primary
              - secondary
              - tertiary
              - fallback
        fallback_only:
          type: boolean
    RoutingRule:
      type: object
      description: >
        A routing rule that explicitly routes payments from specific
        countries/methods to a specific connection.

        Rules are evaluated by priority (highest first). If no rule matches,
        default routing logic is used.
      properties:
        id:
          type: string
        name:
          type: string
          description: Human-readable name for the rule
        countries:
          type: array
          items:
            type: string
          description: ISO 3166-1 alpha-2 country codes (e.g., US, GB, GH)
        methods:
          type: array
          items:
            type: string
          description: Payment methods (e.g., card, mobile_money). Empty means all methods.
        connection_id:
          type: string
          description: The connection to use when this rule matches
        priority:
          type: integer
          description: Higher priority rules are evaluated first
        fallback_to_default:
          type: boolean
          description: If true
          fall back to default routing if the connection is unavailable: null
        enabled:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    RoutingRuleCreate:
      type: object
      required:
        - name
        - countries
        - connection_id
      properties:
        name:
          type: string
          description: Human-readable name for the rule
        countries:
          type: array
          items:
            type: string
          description: ISO 3166-1 alpha-2 country codes (e.g., US, GB, GH)
          minItems: 1
        methods:
          type: array
          items:
            type: string
          description: Payment methods (e.g., card, mobile_money). Empty means all methods.
        connection_id:
          type: string
          description: The connection to use when this rule matches
        priority:
          type: integer
          default: 0
          description: Higher priority rules are evaluated first
        fallback_to_default:
          type: boolean
          default: true
          description: If true
          fall back to default routing if the connection is unavailable: null
        enabled:
          type: boolean
          default: true
    RoutingRuleUpdate:
      type: object
      minProperties: 1
      properties:
        name:
          type: string
        countries:
          type: array
          items:
            type: string
        methods:
          type: array
          items:
            type: string
        connection_id:
          type: string
        priority:
          type: integer
        fallback_to_default:
          type: boolean
        enabled:
          type: boolean
    Pagination:
      type: object
      properties:
        total:
          type: integer
          format: int64
        limit:
          type: integer
        offset:
          type: integer
    Plan:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        monthly_price_cents:
          type: integer
          format: int64
        included_transactions:
          type: integer
        overage_fee_cents:
          type: integer
          format: int64
        max_connections:
          type: integer
        features:
          type: object
          additionalProperties: true
        archived_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    OrgSubscription:
      type: object
      properties:
        org_id:
          type: string
        plan_id:
          type: string
        status:
          type: string
        current_period_start:
          type: string
          format: date-time
        current_period_end:
          type: string
          format: date-time
        cancel_at_period_end:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UpdateSubscriptionRequest:
      type: object
      properties:
        plan_id:
          type: string
      required:
        - plan_id
    BillingSubscriptionResponse:
      type: object
      properties:
        subscription:
          $ref: '#/components/schemas/OrgSubscription'
        plan:
          $ref: '#/components/schemas/Plan'
        usage:
          type: object
          properties:
            transactions:
              type: object
              properties:
                used:
                  type: integer
                  format: int64
                limit:
                  type: integer
            connections:
              type: object
              properties:
                sandbox:
                  type: object
                  properties:
                    used:
                      type: integer
                      format: int64
                    limit:
                      type: integer
                live:
                  type: object
                  properties:
                    used:
                      type: integer
                      format: int64
                    limit:
                      type: integer
    BillingPlansResponse:
      type: object
      properties:
        plans:
          type: array
          items:
            $ref: '#/components/schemas/Plan'
    BillingUsageResponse:
      type: object
      properties:
        org_id:
          type: string
        mode:
          type: string
          enum:
            - sandbox
            - live
        start:
          type: string
          format: date-time
        end:
          type: string
          format: date-time
        usage:
          type: object
          additionalProperties:
            type: integer
            format: int64
      required:
        - org_id
        - mode
        - start
        - end
        - usage
    PlatformPlansResponse:
      type: object
      properties:
        plans:
          type: array
          items:
            $ref: '#/components/schemas/Plan'
    PlatformPlanResponse:
      type: object
      properties:
        plan:
          $ref: '#/components/schemas/Plan'
    PlatformPlanCreateRequest:
      type: object
      properties:
        name:
          type: string
        monthly_price_cents:
          type: integer
          format: int64
        included_transactions:
          type: integer
        overage_fee_cents:
          type: integer
          format: int64
        max_connections:
          type: integer
        features:
          type: object
          additionalProperties: true
      required:
        - name
    PlatformPlanUpdateRequest:
      type: object
      properties:
        name:
          type: string
        monthly_price_cents:
          type: integer
          format: int64
        included_transactions:
          type: integer
        overage_fee_cents:
          type: integer
          format: int64
        max_connections:
          type: integer
        features:
          type: object
          additionalProperties: true
      required:
        - name
    PlatformPlanDeleteResponse:
      type: object
      properties:
        success:
          type: boolean
    Invoice:
      type: object
      properties:
        id:
          type: string
        subscription_id:
          type: string
        org_id:
          type: string
        amount:
          type: integer
        currency:
          type: string
        status:
          type: string
          enum:
            - draft
            - due
            - paid
            - failed
            - canceled
        payment_id:
          type: string
        due_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        retry_count:
          type: integer
        max_retries:
          type: integer
        next_retry_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    FraudPolicyInput:
      type: object
      properties:
        max_amount:
          type: integer
        blocked_bins:
          type: array
          items:
            type: string
        allowed_bins:
          type: array
          items:
            type: string
        velocity_max_per_minute:
          type: integer
    FraudPolicy:
      allOf:
        - $ref: '#/components/schemas/FraudPolicyInput'
        - type: object
          properties:
            org_id:
              type: string
            updated_at:
              type: string
              format: date-time
    FraudPolicyAudit:
      type: object
      properties:
        id:
          type: integer
        org_id:
          type: string
        actor:
          type: string
        max_amount:
          type: integer
          format: int64
        blocked_bins:
          type: array
          items:
            type: string
        allowed_bins:
          type: array
          items:
            type: string
        velocity_max_per_minute:
          type: integer
        created_at:
          type: string
          format: date-time
    Payment:
      type: object
      properties:
        id:
          type: string
        connection_id:
          type: string
        provider:
          type: string
        provider_ref_id:
          type: string
        method:
          type: string
        status:
          type: string
          enum:
            - pending
            - requires_action
            - succeeded
            - failed
            - canceled
            - refunded
            - partially_refunded
        amount:
          type: integer
        currency:
          type: string
        fee_amount:
          type: integer
        fee_currency:
          type: string
        net_amount:
          type: integer
        customer_id:
          type: string
        client_secret:
          type: string
        metadata:
          type: object
          additionalProperties: true
        route:
          type: array
          description: Snapshot of routing attempts for this payment
          items:
            $ref: '#/components/schemas/PaymentRouteAttempt'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    FeeInsight:
      type: object
      properties:
        provider:
          type: string
        method:
          type: string
        payment_count:
          type: integer
        gross_volume:
          type: integer
        total_fees:
          type: integer
        net_volume:
          type: integer
    FeeInsightTotals:
      type: object
      properties:
        payment_count:
          type: integer
        gross_volume:
          type: integer
        total_fees:
          type: integer
        net_volume:
          type: integer
    FeeInsightsResponse:
      type: object
      properties:
        rows:
          type: array
          items:
            $ref: '#/components/schemas/FeeInsight'
        totals:
          $ref: '#/components/schemas/FeeInsightTotals'
    FeeDetail:
      type: object
      properties:
        payment_id:
          type: string
        connection_id:
          type: string
        provider:
          type: string
        method:
          type: string
        amount:
          type: integer
        currency:
          type: string
        fee_amount:
          type: integer
        fee_currency:
          type: string
        net_amount:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PaymentRouteAttempt:
      type: object
      properties:
        connection_id:
          type: string
        provider:
          type: string
        status:
          type: string
        error:
          type: string
        labels:
          type: array
          items:
            type: string
        routing_hints:
          $ref: '#/components/schemas/RoutingHints'
    PaymentDispute:
      type: object
      properties:
        id:
          type: string
        payment_id:
          type: string
        org_id:
          type: string
        status:
          type: string
        reason:
          type: string
        amount:
          type: integer
        currency:
          type: string
        evidence:
          type: object
          additionalProperties: true
        annotations:
          type: object
          additionalProperties: true
        resolution_note:
          type: string
        resolved_by:
          type: string
        resolved_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    DisputeResolveRequest:
      type: object
      required:
        - resolution
      properties:
        resolution:
          type: string
          enum:
            - won
            - lost
            - written_off
        note:
          type: string
        annotations:
          type: object
          additionalProperties: true
    Refund:
      type: object
      properties:
        id:
          type: string
        payment_id:
          type: string
        amount:
          type: integer
        currency:
          type: string
        status:
          type: string
          enum:
            - pending
            - processing
            - succeeded
            - failed
            - manual_review
        reason:
          type: string
        provider_refund_id:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Subscription:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        customer_id:
          type: string
        plan_id:
          type: string
        amount:
          type: integer
        currency:
          type: string
        method:
          type: string
        interval:
          type: string
          enum:
            - monthly
            - yearly
        status:
          type: string
          enum:
            - active
            - paused
            - canceled
        next_renewal_at:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    SubscriptionCreate:
      type: object
      required:
        - customer_id
        - plan_id
        - amount
        - currency
        - method
        - interval
      properties:
        customer_id:
          type: string
        plan_id:
          type: string
        amount:
          type: integer
        currency:
          type: string
        method:
          type: string
        interval:
          type: string
          enum:
            - monthly
            - yearly
        metadata:
          type: object
          additionalProperties: true
    RetryPolicy:
      type: object
      properties:
        org_id:
          type: string
        plan_id:
          type: string
        delays:
          type: array
          items:
            type: string
          description: Array of delay durations (e.g., ["15m", "1h", "24h"])
        max_retries:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    WebhookEvent:
      type: object
      properties:
        id:
          type: string
        provider:
          type: string
        org_id:
          type: string
        payment_id:
          type: string
        event_type:
          type: string
        status:
          type: string
          enum:
            - received
            - applied
            - failed
        payload:
          type: object
          additionalProperties: true
          description: Parsed webhook payload
        headers:
          type: object
          additionalProperties:
            type: string
          description: Webhook headers
        error:
          type: string
        attempts:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    WebhookConfigInput:
      type: object
      required:
        - url
      properties:
        url:
          type: string
        events:
          type: array
          items:
            type: string
    WebhookConfig:
      allOf:
        - $ref: '#/components/schemas/WebhookConfigInput'
        - type: object
          properties:
            org_id:
              type: string
            signing_secret:
              type: string
    OutboundWebhook:
      type: object
      properties:
        id:
          type: string
        event_type:
          type: string
        target_url:
          type: string
        status:
          type: string
          enum:
            - pending
            - delivering
            - succeeded
            - failed
        attempts:
          type: integer
        last_error:
          type: string
        next_attempt_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    QueueSnapshot:
      type: object
      properties:
        queue:
          type: string
        pending:
          type: integer
        active:
          type: integer
        retry:
          type: integer
        scheduled:
          type: integer
        dead:
          type: integer
        latency_seconds:
          type: number
          format: double
        updated_at:
          type: string
          format: date-time
    HealthStatus:
      type: object
      properties:
        status:
          type: string
        timestamp:
          type: string
          format: date-time
        webhook_queue:
          $ref: '#/components/schemas/QueueSnapshot'
        webhook_queue_error:
          type: string
    APIKeyCreate:
      type: object
      properties:
        name:
          type: string
          description: Human-readable name for the API key
        scopes:
          type: array
          items:
            type: string
          description: List of scopes to grant (e.g., ["payments:read", "payments:write"])
      required:
        - name
    APIKey:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        name:
          type: string
        scopes:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        last_used_at:
          type: string
          format: date-time
        revoked_at:
          type: string
          format: date-time
    APIKeyCreateResponse:
      allOf:
        - $ref: '#/components/schemas/APIKey'
        - type: object
          properties:
            raw:
              type: string
              description: The raw API key token (only shown once on creation)
              example: pfk_abc123.xyz789
    SignupRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User email address
        name:
          type: string
          description: User's full name (optional)
      required:
        - email
    MagicLinkRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: Email address to send magic link to
      required:
        - email
    User:
      type: object
      properties:
        id:
          type: string
          description: User identifier
        email:
          type: string
          format: email
        name:
          type: string
        created_at:
          type: string
          format: date-time
    SessionResponse:
      type: object
      properties:
        token:
          type: string
          description: Session token (only shown once on creation)
        expires_at:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/User'
    UserWithMemberships:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        memberships:
          type: array
          items:
            $ref: '#/components/schemas/Membership'
    UpdateProfileRequest:
      type: object
      properties:
        name:
          type: string
          description: User's full name
      required: []
    SessionListItem:
      type: object
      properties:
        id:
          type: string
          description: Session identifier
        created_at:
          type: string
          format: date-time
          description: When the session was created
        last_used_at:
          type: string
          format: date-time
          description: When the session was last used
        expires_at:
          type: string
          format: date-time
          description: When the session expires
        is_current:
          type: boolean
          description: Whether this is the current session
        user_agent:
          type: string
          nullable: true
          description: User agent string
        ip_address:
          type: string
          nullable: true
          description: IP address
        location:
          type: string
          nullable: true
          description: Location (city, country)
      required:
        - id
        - created_at
        - last_used_at
        - expires_at
        - is_current
    TwoFactorRequired:
      type: object
      properties:
        requires_2fa:
          type: boolean
          example: true
        user:
          $ref: '#/components/schemas/User'
    SuspiciousActivity:
      type: object
      properties:
        type:
          type: string
          enum:
            - new_device
            - new_location
            - rapid_location_change
            - multiple_locations
        description:
          type: string
        detected_at:
          type: string
          format: date-time
    OAuthAccount:
      type: object
      properties:
        id:
          type: string
        provider:
          type: string
          enum:
            - google
            - github
        email:
          type: string
          format: email
        name:
          type: string
        avatar_url:
          type: string
          format: uri
        created_at:
          type: string
          format: date-time
    UserPreferences:
      type: object
      properties:
        email_notifications_enabled:
          type: boolean
          description: Enable/disable all email notifications
        security_alerts_enabled:
          type: boolean
          description: Enable/disable security alerts
        new_device_alerts_enabled:
          type: boolean
          description: Enable/disable new device login alerts
        new_location_alerts_enabled:
          type: boolean
          description: Enable/disable new location login alerts
        suspicious_activity_alerts_enabled:
          type: boolean
          description: Enable/disable suspicious activity alerts
        two_factor_alerts_enabled:
          type: boolean
          description: Enable/disable 2FA-related alerts
        require_2fa:
          type: boolean
          description: Require 2FA for account access
        session_timeout_minutes:
          type: integer
          nullable: true
          description: Custom session timeout in minutes (null for default)
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    UpdatePreferencesRequest:
      type: object
      properties:
        email_notifications_enabled:
          type: boolean
        security_alerts_enabled:
          type: boolean
        new_device_alerts_enabled:
          type: boolean
        new_location_alerts_enabled:
          type: boolean
        suspicious_activity_alerts_enabled:
          type: boolean
        two_factor_alerts_enabled:
          type: boolean
        require_2fa:
          type: boolean
        session_timeout_minutes:
          type: integer
          nullable: true
        metadata:
          type: object
          additionalProperties: true
    ActivityLog:
      type: object
      properties:
        id:
          type: string
        activity_type:
          type: string
          description: Type of activity (e.g., login, logout, profile_update)
        activity_description:
          type: string
          description: Human-readable description
        ip_address:
          type: string
        user_agent:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
    WebAuthnCredential:
      type: object
      properties:
        id:
          type: string
          description: Internal credential ID
        credential_id:
          type: string
          description: WebAuthn credential ID (base64url encoded)
        name:
          type: string
          nullable: true
          description: Human-readable name for the credential
        attestation_type:
          type: string
          nullable: true
          description: Attestation type (e.g., "none", "packed")
        transport:
          type: array
          items:
            type: string
          nullable: true
          description: Transport methods (e.g., ["usb", "nfc", "ble"])
        last_used_at:
          type: string
          format: date-time
          nullable: true
          description: When the credential was last used
        created_at:
          type: string
          format: date-time
          description: When the credential was registered
    AdminAuditLog:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Audit log ID
        user_id:
          type: string
          description: ID of the user who performed the action
        org_id:
          type: string
          description: Organization ID where the action was performed
        action:
          type: string
          description: Action performed (e.g., update_user_role, delete_organization)
          example: update_user_role
        resource_type:
          type: string
          description: Type of resource affected
          enum:
            - user
            - organization
        resource_id:
          type: string
          nullable: true
          description: ID of the affected resource
        details:
          type: object
          additionalProperties: true
          description: Additional action details
        ip_address:
          type: string
          nullable: true
          description: IP address of the requester
        user_agent:
          type: string
          nullable: true
          description: User agent of the requester
        success:
          type: boolean
          description: Whether the action succeeded
        error_message:
          type: string
          nullable: true
          description: Error message if action failed
        created_at:
          type: string
          format: date-time
          description: Timestamp when the action was performed
      required:
        - id
        - user_id
        - org_id
        - action
        - resource_type
        - success
        - created_at
    Membership:
      type: object
      properties:
        org_id:
          type: string
          description: Organization ID
        user_id:
          type: string
          description: User ID
        role:
          type: string
          enum:
            - owner
            - admin
            - developer
            - viewer
          description: User role in the organization
        created_at:
          type: string
          format: date-time
          description: When the membership was created
    Organization:
      type: object
      properties:
        id:
          type: string
          description: Organization identifier
        name:
          type: string
          description: Organization name
        org_type:
          type: string
          enum:
            - personal
            - business
        kyc_status:
          type: string
          enum:
            - pending
            - submitted
            - approved
            - rejected
        live_enabled:
          type: boolean
        contact_email:
          type: string
          format: email
          nullable: true
        onboarding_type:
          type: string
          nullable: true
        team_size:
          type: string
          nullable: true
        industry:
          type: string
          nullable: true
        website:
          type: string
          nullable: true
        persona:
          type: string
          nullable: true
        onboarding_status:
          type: string
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error type/category
          example: invalid_request
        code:
          type: string
          description: Machine-readable error code
          example: email_required
        message:
          type: string
          description: Human-readable error message
          example: email is required
        details:
          type: object
          additionalProperties:
            type: string
          description: Optional field-level error details
          example:
            metric: workflow_executions
            used: '2000'
            limit: '2000'
            reset: '2025-01-01T00:00:00Z'
      required:
        - error
        - code
        - message
    Integration:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        type:
          type: string
          enum:
            - email
            - sms
            - notification
            - delivery
        provider:
          type: string
          description: Provider name (resend, sendgrid, twilio, slack, etc.)
        name:
          type: string
        config:
          type: object
          additionalProperties: true
        is_default:
          type: boolean
        status:
          type: string
          enum:
            - active
            - inactive
            - error
        last_used_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CreateIntegrationRequest:
      type: object
      properties:
        type:
          type: string
          enum:
            - email
            - sms
            - notification
            - delivery
        provider:
          type: string
          description: >-
            Provider name (resend, sendgrid, africas_talking, twilio, slack,
            etc.)
        name:
          type: string
        credentials:
          type: object
          additionalProperties: true
          description: Provider-specific credentials (API keys, etc.)
        config:
          type: object
          additionalProperties: true
          description: Provider-specific configuration
        is_default:
          type: boolean
          default: false
      required:
        - type
        - provider
        - name
        - credentials
    Template:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        type:
          type: string
          enum:
            - email
            - sms
        name:
          type: string
        subject:
          type: string
          nullable: true
          description: Email subject (for email templates)
        body:
          type: string
          description: Template body with {{variable}} placeholders
        variables:
          type: array
          items:
            type: string
          description: List of variable names used in the template
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    CreateTemplateRequest:
      type: object
      properties:
        type:
          type: string
          enum:
            - email
            - sms
        name:
          type: string
        subject:
          type: string
          description: Email subject (required for email templates)
        body:
          type: string
          description: Template body with {{variable}} placeholders
        variables:
          type: array
          items:
            type: string
      required:
        - type
        - name
        - body
    UpdateTemplateRequest:
      type: object
      properties:
        name:
          type: string
        subject:
          type: string
        body:
          type: string
        variables:
          type: array
          items:
            type: string
    Workflow:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        enabled:
          type: boolean
        trigger:
          type: string
          enum:
            - payment.created
            - payment.success
            - payment.failed
            - payment.canceled
            - refund.created
            - refund.success
            - dispute.created
        conditions:
          $ref: '#/components/schemas/WorkflowConditions'
        actions:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowAction'
        priority:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    WorkflowConditions:
      type: object
      properties:
        min_amount:
          type: integer
          nullable: true
        max_amount:
          type: integer
          nullable: true
        currencies:
          type: array
          items:
            type: string
          nullable: true
        countries:
          type: array
          items:
            type: string
          nullable: true
        methods:
          type: array
          items:
            type: string
          nullable: true
        customer_ids:
          type: array
          items:
            type: string
          nullable: true
        metadata_match:
          type: object
          additionalProperties: true
          nullable: true
    WorkflowAction:
      type: object
      properties:
        type:
          type: string
          enum:
            - send_email
            - send_sms
            - send_whatsapp
            - send_notification
            - webhook
            - send_segment_event
            - append_google_sheet
            - create_jira_ticket
            - create_linear_issue
            - create_notion_page
            - create_airtable_record
            - create_pagerduty_incident
            - create_opsgenie_alert
            - update_hubspot_contact
            - update_salesforce_lead
            - create_delivery
        integration_id:
          type: string
          nullable: true
        template_id:
          type: string
          nullable: true
        config:
          type: object
          additionalProperties: true
    CreateWorkflowRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        trigger:
          type: string
          enum:
            - payment.created
            - payment.success
            - payment.failed
            - payment.canceled
            - refund.success
            - refund.failed
            - dispute.created
            - dispute.resolved
            - customer.created
            - customer.updated
            - cart.abandoned
            - subscription.renewed
            - subscription.past_due
            - high_risk_score
        conditions:
          $ref: '#/components/schemas/WorkflowConditions'
        actions:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowAction'
        priority:
          type: integer
          default: 0
        enabled:
          type: boolean
          default: true
      description: >
        Create a new workflow automation rule. Triggers are optional - workflows
        can be action-only for manual or scheduled execution.

        At least one of trigger, actions, or conditions must be provided.
    UpdateWorkflowRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        trigger:
          type: string
        conditions:
          $ref: '#/components/schemas/WorkflowConditions'
        actions:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowAction'
        priority:
          type: integer
        enabled:
          type: boolean
    WorkflowExecution:
      type: object
      properties:
        id:
          type: string
        workflow_id:
          type: string
        org_id:
          type: string
        trigger_payload:
          type: object
          additionalProperties: true
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
        error:
          type: string
          nullable: true
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
    ActionResult:
      type: object
      properties:
        id:
          type: string
        execution_id:
          type: string
        action_type:
          type: string
        status:
          type: string
          enum:
            - pending
            - success
            - failed
            - retrying
        response:
          type: object
          additionalProperties: true
          nullable: true
        error:
          type: string
          nullable: true
        retry_count:
          type: integer
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
    FraudRule:
      type: object
      properties:
        id:
          type: string
        org_id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        enabled:
          type: boolean
        rule_type:
          type: string
          enum:
            - velocity
            - amount_threshold
            - country_block
            - card_bin
            - email_domain
            - ip_reputation
        config:
          $ref: '#/components/schemas/FraudRuleConfig'
        action:
          type: string
          enum:
            - block
            - flag
            - allow
        priority:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    FraudRuleConfig:
      type: object
      properties:
        max_amount:
          type: integer
          nullable: true
        min_amount:
          type: integer
          nullable: true
        max_transactions:
          type: integer
          nullable: true
        time_window_minutes:
          type: integer
          nullable: true
        blocked_countries:
          type: array
          items:
            type: string
          nullable: true
        blocked_bins:
          type: array
          items:
            type: string
          nullable: true
        blocked_domains:
          type: array
          items:
            type: string
          nullable: true
    CreateFraudRuleRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        rule_type:
          type: string
          enum:
            - velocity
            - amount_threshold
            - country_block
            - card_bin
            - email_domain
            - ip_reputation
        config:
          $ref: '#/components/schemas/FraudRuleConfig'
        action:
          type: string
          enum:
            - block
            - flag
            - allow
        priority:
          type: integer
          default: 0
        enabled:
          type: boolean
          default: true
      required:
        - name
        - rule_type
        - config
        - action
    KYCSubmissionRequest:
      type: object
      description: Business verification information for KYC
      properties:
        business_name:
          type: string
          description: Legal registered business name
          example: Acme Payments Ltd
        registration_no:
          type: string
          description: Business registration or incorporation number
          example: CS123456789
        business_address:
          type: string
          description: Registered business address
          example: 123 Business Street, Accra, Ghana
        business_country:
          type: string
          description: ISO 3166-1 alpha-2 country code
          example: GH
          minLength: 2
          maxLength: 2
        website:
          type: string
          format: uri
          description: Company website URL (optional)
          example: https://acmepayments.com
        metadata:
          type: object
          additionalProperties: true
          description: Additional metadata (optional)
      required:
        - business_name
        - registration_no
        - business_address
        - business_country
    KYCStatusResponse:
      type: object
      description: KYC verification status for an organization
      properties:
        org_id:
          type: string
          description: Organization ID
          example: org_abc123
        kyc_status:
          type: string
          description: Current KYC verification status
          enum:
            - pending
            - submitted
            - approved
            - rejected
          example: approved
        live_enabled:
          type: boolean
          description: Whether live-mode features are enabled
          example: true
      required:
        - org_id
        - kyc_status
        - live_enabled
    KYCSubmission:
      type: object
      description: KYC submission for platform admin review
      properties:
        org_id:
          type: string
          description: Organization ID
        org_name:
          type: string
          description: Organization name
        business_name:
          type: string
          description: Legal business name
        registration_no:
          type: string
          description: Business registration number
        business_address:
          type: string
          description: Registered business address
        business_country:
          type: string
          description: ISO country code
        website:
          type: string
          description: Company website
        status:
          type: string
          enum:
            - pending
            - submitted
            - approved
            - rejected
        submitted_at:
          type: string
          format: date-time
        reviewed_at:
          type: string
          format: date-time
          nullable: true
    PlatformAdmin:
      type: object
      description: Platform administrator
      properties:
        id:
          type: string
          description: Platform admin record ID
        user_id:
          type: string
          description: User ID
        role:
          type: string
          enum:
            - platform_admin
            - platform_owner
          description: Platform role
        created_at:
          type: string
          format: date-time
        email:
          type: string
          description: Admin email (when available)
        name:
          type: string
          description: Admin name (when available)
    PlatformAuditLog:
      type: object
      description: Platform audit log entry
      properties:
        id:
          type: string
          description: Audit log ID
        admin_id:
          type: string
          description: Platform admin ID who performed the action
        action:
          type: string
          description: Action performed (e.g., kyc_approved, org_updated)
        resource_type:
          type: string
          description: Type of resource affected (e.g., organization, kyc)
        resource_id:
          type: string
          description: ID of the affected resource
        details:
          type: object
          additionalProperties: true
          description: Additional action details
        ip_address:
          type: string
          description: IP address of the admin
        user_agent:
          type: string
          description: User agent of the admin
        created_at:
          type: string
          format: date-time
  parameters:
    XOrgId:
      in: header
      name: X-Org-Id
      required: true
      schema:
        type: string
      description: Organization identifier for multi-tenancy
    IdempotencyKey:
      in: header
      name: Idempotency-Key
      required: false
      schema:
        type: string
      description: Idempotency key for safe retries
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-Reevit-Key
      description: API key for server-to-server authentication
    SessionAuth:
      type: apiKey
      in: cookie
      name: reevit_session
      description: >-
        Session cookie for user authentication (set automatically after magic
        link verification). Can also be provided as Bearer token in
        Authorization header.
  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    BadGateway:
      description: Bad Gateway
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    TooManyRequests:
      description: Too Many Requests - Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    PaymentRequired:
      description: Payment Required - Subscription/plan enforcement
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
